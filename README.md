# 日语注音生成工具
## 项目概述
“日语注音生成工具”是一款面向日语学习者、内容创作者及教育工作者开发的**高性能日语注音生成与语音朗读工具**。该工具在传统注音功能基础上全面升级，整合了Web Speech API实时语音朗读、多格式数据导出、可定制UI主题等实用功能，以“本地化运行+隐私保护”为核心，兼顾易用性与专业性，满足不同场景下的日语处理需求。


## 核心功能清单
| 功能分类         | 具体功能描述                                                                 |
|------------------|------------------------------------------------------------------------------|
| 智能注音解析     | 自动识别“汉字（假名）”“英文（片假名）”格式的注音标注，过滤无效注音（如非汉字/英文标注） |
| 实时预览         | 输入内容变动时即时更新预览效果，保持段落、句子结构的完整排版                  |
| 多模式语音朗读   | 基于Web Speech API实现日语语音合成，支持句子级高亮、滚动跟随，直观展示朗读进度 |
| 界面定制         | 明暗主题切换、字体大小调节、注音显示/隐藏切换，适配不同使用场景与视觉偏好      |
| 多格式导出       | 支持复制“注音HTML代码（含ruby标签）”“带注音文本（括号格式）”“纯文本（无注音）” |
| 本地数据持久化   | 输入历史、UI设置、TTS（文本转语音）参数通过localStorage保存，下次打开自动恢复 |
| 响应式设计       | 自动适配PC、平板、手机等设备屏幕，确保不同终端下的操作体验一致                |
| 打印优化         | 打印时自动隐藏控制按钮、设置面板等非内容元素，仅保留注音文本，适配纸质输出    |


## 技术架构
### 1. 技术栈
| 层级          | 技术/规范说明                                                               |
|---------------|------------------------------------------------------------------------------|
| 前端基础      | HTML5（语义化结构）、CSS3（自定义属性+过渡动画）、原生JavaScript（无框架依赖） |
| 语音合成      | Web Speech API（SpeechSynthesis接口+SpeechSynthesisUtterance实例）           |
| 本地存储      | localStorage（键值对存储，用于持久化用户配置与输入数据）                     |
| 可访问性      | ARIA标签（aria-label/aria-live）、键盘操作支持、屏幕阅读器兼容                |

### 2. 核心模块设计
#### （1）注音解析引擎
- **核心功能**：识别文本中“汉字（假名）”“英文（片假名）”格式，转换为标准HTML `<ruby>` 注音标签。
- **实现逻辑**：通过正则表达式 `/((?:[一-龯々〆ヵヶ]+)|(?:[a-zA-Z0-9]+))（([ぁ-んァ-ヶー]+?)）/g` 匹配有效注音结构，排除非汉字/英文的无效标注（如“ひらがな（ヒラガナ）”）。
- **安全处理**：自动转义HTML特殊字符（&/<>/"/'等），避免XSS攻击风险。

#### （2）语音朗读管理系统
- **语音队列管理**：按“段落→句子”层级生成SpeechSynthesisUtterance实例，构建有序朗读队列，避免语音重叠。
- **同步高亮机制**：通过`onboundary`事件获取当前朗读的字符位置（charIndex），与句子的`rangeStart`/`rangeEnd`匹配，动态为当前句子添加高亮样式，并自动滚动到可视区域。
- **状态控制**：支持“播放/暂停/恢复/停止”全流程控制，实时更新按钮状态（如播放时禁用“播放”按钮，启用“暂停/停止”按钮）。

#### （3）主题与样式系统
- **CSS变量驱动**：通过`--bg-color`（背景色）、`--text-color`（文本色）、`--accent-color`（强调色）等自定义属性统一管理主题样式，切换主题时仅需修改类名。
- **动态主题切换**：通过添加/移除`dark-mode`类实现明暗主题切换，同步更新文本、背景、按钮等所有元素样式，过渡动画确保视觉流畅性。
- **响应式适配**：通过媒体查询（`max-width: 768px`/`max-width: 600px`）优化移动端布局，如按钮全屏显示、滑块布局调整，适配触控操作。

#### （4）本地存储管理器
| 存储键名         | 存储内容                  | 默认值                     |
|------------------|---------------------------|----------------------------|
| `inputText`      | 用户输入文本              | 示例文本（标准日语段落）   |
| `fontSize`       | 预览文本字体大小（em）    | 1.2                        |
| `theme`          | 主题模式（light/dark）    | light                      |
| `rubyVisible`    | 注音显示状态（true/false）| true                       |
| `ttsRate`        | TTS朗读速度（0.5-2.0）    | 1.0                        |
| `ttsPitch`       | TTS语音音调（0.0-2.0）    | 1.0                        |
| `preferredVoice` | 用户偏好TTS语音名称       | 系统首个日语语音           |


## 快速上手
### 1. 环境要求
- **浏览器**：Chrome 54+、Firefox 49+、Edge 14+、Safari 14.1+（需支持Web Speech API）。
- **额外配置**：建议在操作系统或浏览器中预装日语语音包（如Windows“微软日语语音”、macOS“日语语音”）。

### 2. 使用步骤
1. **文件准备**：将项目中的`index.html`文件保存到本地。
2. **启动工具**：双击保存的`index.html`文件，通过支持的浏览器打开。
3. **文本输入**：
   - 在文本框中直接输入日语内容（格式示例：`日本語（にほんご）の文章（ぶんしょう）`）。
   - 如需使用示例文本，点击“例文”按钮（可通过下拉菜单选择不同类型的示例）。
4. **预览查看**：输入内容会实时在“显示结果”区域生成带注音的文本，无需额外操作。
5. **语音朗读**：
   - 在“语音朗读”模块的“声的选择”下拉菜单中，选择已安装的日语语音。
   - 点击“▶️ 播放”开始朗读，可通过“⏸️ 暂停”“⏯️ 恢复”“⏹️ 停止”控制进度。
   - 拖动“速さ”“高さ”滑块，调整朗读速度与音调。
6. **界面定制**：
   - 点击“🌙/☀️”按钮切换明暗主题。
   - 通过“ー/+”按钮减小/增大预览文本字体大小。
   - 点击“注音 OFF/ON”按钮显示或隐藏注音。
7. **内容导出**：
   - “📋 HTML复制”：复制带`<ruby>`标签的HTML代码，可嵌入其他网页。
   - “📄 文本复制”：复制带括号注音的文本（如“汉字（かんじ）”）。
   - “🧹 元文本复制”：复制移除注音后的纯日语文本，适用于翻译或二次编辑。


## 详细功能说明
### 1. 智能注音解析
#### （1）支持的注音格式
| 输入格式          | 输出HTML结果                          | 说明                          |
|-------------------|---------------------------------------|-------------------------------|
| 汉字（かんじ）    | `<ruby>汉字<rt>かんじ</rt></ruby>`    | 标准汉字注音，最常用场景      |
| English（イングリッシュ） | `<ruby>English<rt>イングリッシュ</rt></ruby>` | 英文单词标注片假名读音        |
| 複合語（ふくご）例（れい） | `<ruby>複合語<rt>ふくご</rt></ruby><ruby>例<rt>れい</rt></ruby>` | 连续多个注音的自动识别        |

#### （2）无效注音过滤规则
- 非汉字/英文的注音（如“ひらがな（ヒラガナ）”“数字（スズ）”）：不转换为`<ruby>`标签，保留原始文本格式。
- 不完整注音（如“汉字（”“（かんじ）”）：视为普通文本，不进行注音处理。

### 2. 语音朗读功能细节
#### （1）朗读状态控制
- **播放**：按段落顺序朗读全部内容，首个段落自动高亮，句子随朗读进度切换高亮。
- **暂停**：中断当前朗读，保留进度，再次点击“恢复”可从暂停位置继续。
- **停止**：终止所有朗读任务，清空队列，重置高亮状态。

#### （2）视觉反馈设计
- **段落高亮**：当前朗读的段落添加浅橙色背景（暗色模式为深橙色），明确朗读范围。
- **句子高亮**：当前朗读的句子添加深橙色背景（暗色模式为暗橙色），突出核心内容。
- **自动滚动**：若当前句子不在可视区域，页面自动平滑滚动，确保句子始终可见。

### 3. 导出功能应用场景
| 导出格式         | 适用场景                                  |
|------------------|-------------------------------------------|
| 注音HTML代码     | 制作日语学习网页、博客文章，需保留注音样式 |
| 带注音文本       | 撰写Word/Excel文档、PPT，需显示注音但无需HTML格式 |
| 纯文本（无注音） | 导入翻译工具、语音合成软件，或用于简洁排版 |

### 4. 打印功能特点
- **内容净化**：打印时自动隐藏控制按钮、语音设置、示例选择等非内容元素，仅保留带注音的文本。
- **格式适配**：默认按A4纸张优化排版，调整字体大小与行距，确保纸质输出清晰易读。
- **注音保留**：打印结果与预览一致，注音正常显示（若当前为“注音隐藏”模式，则不打印注音）。


## 定制与扩展
### 1. 主题定制
修改`index.html`中`<style>`标签内的`--root`与`.dark-mode`样式变量，可自定义主题配色：
```css
:root {
  --bg-color: #f5f5f5;       /* 亮色模式背景色（默认浅灰） */
  --text-color: #333333;     /* 亮色模式文本色（默认深灰） */
  --accent-color: #2196f3;   /* 亮色模式强调色（默认蓝色） */
  /* 其他样式变量可按需修改 */
}

.dark-mode {
  --bg-color: #1e1e1e;       /* 暗色模式背景色（默认深灰） */
  --text-color: #f0f0f0;     /* 暗色模式文本色（默认浅灰） */
  --accent-color: #4dabf7;   /* 暗色模式强调色（默认亮蓝） */
  /* 其他样式变量可按需修改 */
}
```

### 2. 示例文本扩展
在`sampleTexts`数组中添加新对象，可扩展示例文本库：
```javascript
const sampleTexts = [
  // 现有示例...
  {
    name: "日语日常对话",
    text: "A：今日（きょう）は何（なに）をしますか？\nB：図書館（としょかん）に行（い）って本（ほん）を借（か）ります。"
  }
];
```

### 3. 语音朗读参数调整
- **朗读速度范围**：修改`rateSlider`的`min`/`max`属性（默认0.5-2.0），如`<input type="range" id="rateSlider" min="0.3" max="3" step="0.1" value="1">`。
- **音调范围**：修改`pitchSlider`的`min`/`max`属性（默认0.0-2.0），如`<input type="range" id="pitchSlider" min="0.5" max="2.5" step="0.1" value="1">`。


## 技术特点
1. **轻量无依赖**：基于原生JavaScript开发，不依赖React、Vue等框架，文件体积小，加载速度快，可离线使用。
2. **高可访问性**：
   - 支持键盘操作（Tab键切换控件，Enter键触发按钮），无需依赖鼠标。
   - 集成ARIA标签，适配屏幕阅读器，视力障碍用户可正常使用。
3. **优质用户体验**：
   - 输入防抖（250ms延迟）：避免频繁输入时的重复渲染，提升性能。
   - 按钮反馈：点击按钮时添加缩放动画（`transform: scale(0.97)`），提供明确的操作反馈。
4. **稳定的错误处理**：
   - 语音合成错误：通过`utterance.onerror`捕获错误，弹出提示告知用户。
   - 剪贴板复制失败：捕获`navigator.clipboard.writeText`异常，记录日志并提示用户重试。
5. **隐私保护**：所有数据（输入文本、配置参数）仅存储在本地浏览器的localStorage中，不与服务器交互，确保数据安全。


## 浏览器兼容性
| 浏览器         | 版本要求 | 功能支持情况                     |
|----------------|----------|----------------------------------|
| Google Chrome  | 54+      | 完全支持所有功能                 |
| Mozilla Firefox| 49+      | 完全支持，语音选择界面略有差异   |
| Microsoft Edge | 14+      | 完全支持所有功能                 |
| Apple Safari   | 14.1+    | 完全支持，需预装macOS日语语音包 |
| Internet Explorer | 所有版本 | 不支持（未实现Web Speech API）   |


## 常见问题（FAQ）
### Q1：无法播放语音怎么办？
A1：请按以下步骤排查：
1. 确认浏览器是否支持Web Speech API（参考“浏览器兼容性”章节）。
2. 检查操作系统/浏览器是否安装日语语音包（如Windows“设置→时间和语言→语音”，macOS“系统设置→辅助功能→语音”）。
3. 在“语音朗读”模块的“声的选择”中，确认已选中有效的日语语音（非灰色不可选状态）。

### Q2：输入的注音不显示怎么办？
A2：请检查以下几点：
1. 注音格式是否正确：需使用“汉字（假名）”或“英文（片假名）”格式，且括号为全角“（）”（半角“()”无效）。
2. 确认“注音 OFF/ON”按钮处于“注音 ON”状态（按钮显示“注音 OFF”表示当前为显示状态）。
3. 排除无效注音：非汉字/英文的内容（如“ひらがな（ヒラガナ）”）不会被识别为有效注音，需调整输入格式。

### Q3：配置参数（如主题、字体大小）无法保存怎么办？
A3：可能原因及解决方法：
1. 浏览器禁用localStorage：进入浏览器设置，解除对localStorage的限制（如Chrome“设置→隐私和安全→网站设置→JavaScript”，确保启用JavaScript）。
2. 使用隐私模式：隐私模式下localStorage数据会在关闭窗口后清除，建议使用普通浏览模式。
3. 误操作“设置重置”：点击“🔄 设定重置”会清除所有配置，需重新调整参数。

